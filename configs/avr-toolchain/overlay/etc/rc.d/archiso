# vim: set ft=sh:
. /etc/rc.conf
. /etc/rc.d/functions
. /etc/archiso/functions

do_makeuser ()
{
    stat_busy "Making the default user arch"
    addgroups="audio,disk,optical,wheel"
    useradd -m -p "" -g users -G $addgroups arch
    stat_done
}

do_locale_gen ()
{
    stat_busy "Generating locales..."
    sed -i "s/#\(${LOCALE/[@.]*}\)/\1/" /etc/locale.gen
    /usr/sbin/locale-gen > /dev/null
    stat_done
}

# GIT does not manage perms others thans 755 and 644, so fix here.
do_fix_perms ()
{
    stat_busy "Fixing file permissions..."
    chmod 440 /etc/sudoers
    stat_done
}

case "$1" in
  start)
    do_locale_gen
    do_makeuser
    do_fix_perms
    ;;
esac
exit 0
